\documentclass[a4paper,12pt]{article}
\RequirePackage{ifluatex} % Checks if the document is compiled with LuaLaTeX
\ifluatex%
	\usepackage{luacode} % Allows embedding Lua code directly in LaTeX
	\edef\nxTeXPath{\directlua{tex.sprint(os.getenv("TEXMFHOME"))}}
	\directlua{
		local pkgrt = os.getenv('G_NEX_MOD_LIB') .. '/lua/'
		package.path = pkgrt .. '?.lua;' .. pkgrt .. 'opt/?.lua;' .. package.path
		package.path = pkgrt .. 'luatex/?.lua;' .. pkgrt  .. 'luatex/opt/?.lua;' .. package.path
		nex = require('luatex/nex-luatex-init')
	}
	\makeatletter
	\def\input@path{{\nxTeXPath/sty/}}
	\makeatother
	\message{Posix-Nexus LuaLaTeX preamble fully loaded!}
\else%
	\PackageError{luacode}{LuaTeX is required, but not detected}{}%
\fi%

\nxHyper[]%
\nxSnowFade%

\def\nxInput#1{\input{./contents/posix-nexus/#1.tex}}%

\begin{document}
	\nxSnowFlakeHeader{Posix-Nexus}
\end{document}
