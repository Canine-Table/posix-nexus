
\makeatletter
%\newcommand*\l@tcolorbox{\@dottedtocline{1}{1.5em}{2.3em}}
\makeatother

\tcbset{%
	enhanced,
	autoparskip,
	hyphenationfix,
	dark/.style={
		colframe=nex.dark.frame,
		colback=nex.dark.back,
		colbacktitle=nex.dark.back.title,
		colbacklower=nex.dark.back.lower,
		colupper=nex.dark.lower,
		collower=nex.dark.upper,
		coltitle=nex.dark.title,
		coltext=nex.dark.text
	},
	light/.style={
		colframe=nex.light.frame,
		colback=nex.light.back,
		colbacktitle=nex.light.back.title,
		colbacklower=nex.light.back.lower,
		colupper=nex.light.lower,
		collower=nex.light.upper,
		coltitle=nex.light.title,
		coltext=nex.light.text
	},
	primary/.style={
		colframe=nex.primary.frame,
		colback=nex.primary.back,
		colbacktitle=nex.primary.back.title,
		colbacklower=nex.primary.back.lower,
		colupper=nex.primary.lower,
		collower=nex.primary.upper,
		coltitle=nex.primary.title,
		coltext=nex.primary.text
	},
	secondary/.style={
		colframe=nex.secondary.frame,
		colback=nex.secondary.back,
		colbacktitle=nex.secondary.back.title,
		colbacklower=nex.secondary.back.lower,
		colupper=nex.secondary.lower,
		collower=nex.secondary.upper,
		coltitle=nex.secondary.title,
		coltext=nex.secondary.text
	},
	danger/.style={
		colframe=nex.danger.frame,
		colback=nex.danger.back,
		colbacktitle=nex.danger.back.title,
		colbacklower=nex.danger.back.lower,
		colupper=nex.danger.lower,
		collower=nex.danger.upper,
		coltitle=nex.danger.title,
		coltext=nex.danger.text
	},
	success/.style={
		colframe=nex.success.frame,
		colback=nex.success.back,
		colbacktitle=nex.success.back.title,
		colbacklower=nex.success.back.lower,
		colupper=nex.success.lower,
		collower=nex.success.upper,
		coltitle=nex.success.title,
		coltext=nex.success.text
	},
	warning/.style={
		colframe=nex.warning.frame,
		colback=nex.warning.back,
		colbacktitle=nex.warning.back.title,
		colbacklower=nex.warning.back.lower,
		colupper=nex.warning.lower,
		collower=nex.warning.upper,
		coltitle=nex.warning.title,
		coltext=nex.warning.text
	},
	info/.style={
		colframe=nex.info.frame,
		colback=nex.info.back,
		colbacktitle=nex.info.back.title,
		colbacklower=nex.info.back.lower,
		colupper=nex.info.lower,
		collower=nex.info.upper,
		coltitle=nex.info.title,
		coltext=nex.info.text
	},
	shpA/.style={
		square,
		halign=center,
		valign=center,
		circular arc
	},
	ovrA/.style={
		overlay={
			\foreach \x in {2cm,3.5cm}{
				\begin{scope}[shift={([xshift=\x]frame.north west)}]
					\path[draw=tcbcolframe,fill=tcbcolframe!10,line width=1mm] (0,0) arc (0:180:5mm);
					\path[fill=black] (-0.2,0) arc (0:180:1mm);
				\end{scope}
			}
		}
	},
	crnA/.style={
		arc=8pt,
		if odd page={
			sharp corners=downhill,
			leftrule=3mm
		}{
			sharp corners=uphill,
			rightrule=3mm
		}
	},
	crnE/.style={
		arc=8pt,
		sharp corners,
		rightrule=1.5mm,
		rounded corners=east
	},
	crnW/.style={
		arc=8pt,
		sharp corners,
		leftrule=1.5mm,
		rounded corners=west
	},
	grwA/.style={
		grow to right by=1cm,
		grow to left by=1cm
	},
	grwB/.style={
		grow to right by=1.5cm,
		grow to left by=1.5cm
	},
	sdwA/.style={
		lifted shadow={1mm}{-2mm}{3mm}{0.1mm}{black!50!white}
	},
	frmA/.style={
		frame style={pattern=crosshatch dots light steel blue}
	},
	frmB/.style={
		frame code={
			\foreach \n in {north east,north west,south east,south west}{%
				\path[fill=tcbcolframe] (interior.\n) circle (3mm);
			}
		}
	},
	frmC/.style={
		frame style={
			left color={\ifodd\the\count0 nex.danger.frame\else nex.warning.frame\fi},
			right color={\ifodd\the\count0 nex.warning.frame\else nex.danger.frame\fi}
		}
	},
	frmD/.style={
		frame style={
		left color={\ifodd\the\count0 nex.success.frame\else nex.secondary.back.title\fi},
			right color={\ifodd\the\count0 nex.secondary.back.title\else nex.success.frame\fi}
		}
	},
	frmE/.style={
		frame style={
			left color={\ifodd\the\count0 nex.info.back\else nex.warning.frame\fi},
			right color={\ifodd\the\count0 nex.warning.frame\else nex.info.back\fi}
		}
	},
	inrA/.style={
		interior code={
			\path[draw=red!5!white,line width=5mm,line cap=round]
			([xshift=3mm,yshift=-3mm]interior.north west)
				--([xshift=-3mm,yshift=3mm]interior.south east)
			([xshift=3mm,yshift=3mm]interior.south west)
				--([xshift=-3mm,yshift=-3mm]interior.north east);
		}
	},
	inrB/.style={
		drop fuzzy shadow,
		borderline={0.3mm}{0.35mm}{tcbcolback},
		finish={
			\ifodd\the\count0%
				\begin{tcbclipframe}
					\path[bottom color=black,top color=black!50!white,opacity=0.1]
						(frame.south west) -- (frame.south east) -- (frame.north east) -- cycle;
					\path[top color=white,bottom color=black!50!white,opacity=0.1]
					(frame.south west) -- (frame.north east) -- (frame.north west) -- cycle;
				\end{tcbclipframe}
			\else%
				\begin{tcbclipframe}
					\path[top color=white,bottom color=black!50!white,opacity=0.1]
						(frame.north east) -- (frame.south west) -- (frame.south east) -- cycle;
					\path[bottom color=black,top color=black!50!white,opacity=0.1]
						(frame.north west) -- (frame.north east) -- (frame.south east) -- cycle;
				\end{tcbclipframe}
			\fi%
		}
	},
	segA/.style={
		segmentation code={
			\path[top color=tcbcolframe,bottom color=tcbcolframe,middle color=tcbcolback]
				(segmentation.south west) rectangle (segmentation.north east);
			}
	},
	segB/.style={
		segmentation style={
			double=white,
			draw=tcbcolframe,
			double distance=1pt,
			solid
		}
	},
	titA/.style={
		title code={
			\path[draw=tcbcolback,decorate,line width=2mm, decoration={coil,aspect=0,segment length=10.1mm}]
				([xshift=1mm]title.west) -- ([xshift=-1mm]title.east);
		}
	},
	titB/.style={
		title style={
			left color=blue!15!yellow,
			right color=red!85!black
		}
	},
	titC/.style={
		titlerule style={
			arrows ={
				Hooks[arc=270]-Hooks[arc=270]
			}
		}
	},
	hdrA/.style={
		boxed title style={%
			frame code={%
				\path[fill=tcbcolback!30!black]%
				([yshift=-1mm,xshift=-1mm]frame.north west) arc[start angle=0,end angle=180,radius=1mm]%
				([yshift=-1mm,xshift=1mm]frame.north east) arc[start angle=180,end angle=0,radius=1mm];%
				\path[%
					left color=tcbcolback!60!black,%
					right color=tcbcolback!60!black,%
					middle color=tcbcolback!80!black%
				] ([xshift=-2mm]frame.north west) -- ([xshift=2mm]frame.north east)%
				[rounded corners=1mm]-- ([xshift=1mm,yshift=-1mm]frame.north east)%
				-- (frame.south east) -- (frame.south west)%
				-- ([xshift=-1mm,yshift=-1mm]frame.north west)%
				[sharp corners]-- cycle;%
			},%
			interior engine=empty%
		},
		attach boxed title to top left={xshift=1cm,yshift*=1mm-\tcboxedtitleheight},%
	},
	hdrB/.style={
		attach boxed title to top center={%
			yshift=-0.25mm-\tcboxedtitleheight/2,%
			yshifttext=2mm-\tcboxedtitleheight/2%
		},%
		boxed title style={%
			boxrule=0.5mm,%
			frame code={%
				\path[tcb fill frame] ([xshift=-4mm]frame.west)%
				-- (frame.north west) -- (frame.north east) -- ([xshift=4mm]frame.east)%
				-- (frame.south east) -- (frame.south west) -- cycle; },%
				interior code={ \path[tcb fill interior] ([xshift=-2mm]interior.west)%
				-- (interior.north west) -- (interior.north east)%
				-- ([xshift=2mm]interior.east) -- (interior.south east) -- (interior.south west)%
				-- cycle;%
			}%
		}%
	},
	hdrC/.style={
		skin=enhancedlast jigsaw,
		attach boxed title to top left={xshift=-4mm,yshift=-0.5mm},
		boxed title style={empty,arc=0pt,outer arc=0pt,boxrule=0pt},
		underlay boxed title={
			\fill[tcbcolbacktitle!45!white] (title.north west) -- (title.north east)
			-- +(\tcboxedtitleheight-1mm,-\tcboxedtitleheight+1mm)
			-- ([xshift=4mm,yshift=0.5mm]frame.north east) -- +(0mm,-1mm)
			-- (title.south west) -- cycle;
			\fill[tcbcolbacktitle!45!white!50!black] ([yshift=-0.5mm]frame.north west)
			-- +(-0.4,0) -- +(0,-0.3) -- cycle;
			\fill[tcbcolbacktitle!45!white!50!black] ([yshift=-0.5mm]frame.north east)
			-- +(0,-0.3) -- +(0.4,0) -- cycle;
		}
	},
	hdrD/.style={
		skin=enhancedlast jigsaw,interior hidden,
		boxsep=0pt,top=0pt,
		attach boxed title to bottom center,
		boxed title style={empty,boxrule=0.5mm},
		varwidth boxed title=0.5\linewidth,
		underlay boxed title={
		\draw[tcbcolframe,line width=0.5mm]
		([xshift=0.3mm-\tcboxedtitleheight*2,yshift=0.3mm]title.north west)
			--([xshift=-0.3mm+\tcboxedtitleheight*2,yshift=0.3mm]title.north east);
			\path[draw=tcbcolbacktitle,top color=tcbcolframe,bottom color=tcbcolbacktitle,line width=0.5mm]
			([xshift=0.25mm-\tcboxedtitleheight*2,yshift=0.25mm]title.north west)
			cos +(\tcboxedtitleheight,-\tcboxedtitleheight/2)
			sin +(\tcboxedtitleheight,-\tcboxedtitleheight/2)
			-- ([xshift=0.25mm,yshift=0.25mm]title.south west)
			-- ([yshift=0.25mm]title.south east)
			cos +(\tcboxedtitleheight,\tcboxedtitleheight/2)
			sin +(\tcboxedtitleheight,\tcboxedtitleheight/2);
		}%
	},
	hdrE/.style={
		toprule=1mm,
		titlerule=1mm,
		lefttitle=4mm,
		righttitle=4mm,
		toptitle=1mm,
		bottomtitle=1mm
	},
	nexcols/.style={
		nobeforeafter,
		leftright skip=0mm,
	},
	coltwo/.style={
		width=\linewidth/2-1pt
	},
	colthree/.style={
		width=\linewidth/3-1pt
	},
	colnthree/.style={
		width=\linewidth-\linewidth/3-3pt
	},
	colfour/.style={
		width=\linewidth/4-1pt
	},
	colnfour/.style={
		width=\linewidth-\linewidth/4-4pt
	},
	colfive/.style={
		width=\linewidth/5-1pt
	},
	colnfive/.style={
		width=\linewidth-\linewidth/5-5pt
	}
}

\NewTColorBox{NxMainBox}{O{}}{
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxIWBox}{O{}}{
	inrB,
	crnA,
	warning
	IfBlankF={#1}{#1},
}

\NewTColorBox{NxIGBox}{O{}}{
	inrB,
	crnA,
	success,
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxIIBox}{O{}}{
	inrB,
	crnA,
	info,
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxIEBox}{O{}}{
	inrB,
	crnA,
	danger,
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxISBox}{O{}}{
	inrB,
	crnA,
	secondary,
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxIPBox}{O{}}{
	inrB,
	crnA,
	primary,
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxILBox}{O{}}{
	inrB,
	crnA,
	light,
	IfBlankF={#1}{#1}
}

\NewTColorBox{NxIDBox}{O{}}{
	inrB,
	crnA,
	dark,
	IfBlankF={#1}{#1}
}

\def\nxRef#1#2#3{\hyperref[#1]{\textcolor{nex.primary.back}{\nxBox{primary}{#2}\bf~~#3}}}
\def\nxUpRef#1#2#3{\nxRef{#1}{\faAngleUp~#2}{#3}}
\def\nxDownRef#1#2#3{\nxRef{#1}{\faAnglDown~#2}{#3}}

\nxNCount{nxSN}
\nxNCount{nxSSN}
\nxNCount{nxSSSN}
\nxNCount{nxSSSSN}

\NewDocumentEnvironment{NxSBox}{O{}O{}}
{
	\nxEmpty{#2}{\def\nxTa{\nxUpRef{sec:\nxS}{\nxRoman{\the\nxSN}}{\nxS}}}{%
		\global\def\nxS{#2}
		\nxAdd{nxSN}{1}
		\global\def\nxSS{}
		\nxAssign{nxSSN}{0}
		\global\def\nxSSS{}
		\nxAssign{nxSSSN}{0}
		\global\def\nxSSSS{}
		\nxAssign{nxSSSSN}{0}
		\phantomsection{}
		\label{sec:#2}
		\addcontentsline{toc}{section}{#2}
		\global\def\nxSDepth{0}
		\def\nxTa{\nxBox{light}{\nxRoman{\the\nxSN}}\bf~~\nxS}
	}
	\begin{NxILBox}[#1, hdrA, sdwA, frmC, title={\nxTa}]
}{\end{NxILBox}\bigskip}

\NewDocumentEnvironment{NxSSBox}{O{}O{}}
{
	\nxEmpty{#2}{\def\nxTa{\nxUpRef{ssec:\nxSS}{\nxRoman{\the\nxSSN}}{\nxSS}}}{%
		\global\def\nxSS{#2}
		\nxAdd{nxSSN}{1}
		\global\def\nxSSS{}
		\nxAssign{nxSSSN}{0}
		\global\def\nxSSSS{}
		\nxAssign{nxSSSSN}{0}
		\phantomsection{}
		\label{ssec:#2}
		\addcontentsline{toc}{subsection}{#2}
		\global\def\nxSDepth{1}
		\def\nxTa{\nxBox{light}{\nxRoman{\the\nxSN}.\nxRoman{\the\nxSSN}}\bf~~\nxSS}
	}
	\begin{NxILBox}[#1, hdrA, sdwA, frmD, title={\nxTa}]
}{\end{NxILBox}\bigskip}

\NewDocumentEnvironment{NxSSSBox}{O{}O{}}
{
	\nxEmpty{#2}{\def\nxTa{\nxUpRef{sssec:\nxSSS}{\nxRoman{\the\nxSSSN}}{\nxSSS}}}{%
		\global\def\nxSSS{#2}
		\nxAdd{nxSSSN}{1}
		\global\def\nxSSSS{}
		\nxAssign{nxSSSSN}{0}
		\phantomsection{}
		\label{sssec:#2}
		\addcontentsline{toc}{subsubsection}{#2}
		\global\def\nxSDepth{2}
		\def\nxTa{\nxBox{light}{\nxRoman{\the\nxSN}.\nxRoman{\the\nxSSN}.\nxRoman{\the\nxSSSN}}\bf~~\nxSSS}
	}
	\begin{NxILBox}[#1, hdrA, sdwA, frmE, title={\nxTa}]
}{\end{NxILBox}\bigskip}

\NewDocumentEnvironment{NxSSSSBox}{O{}O{}}
{
	\nxEmpty{#2}{\def\nxTa{\nxUpRef{ssssec:\nxSSSS}{\nxRoman{\the\nxSSSSN}}{\nxSSSS}}}{%
		\global\def\nxSSSS{#2}
		\nxAdd{nxSSSSN}{1}
		\phantomsection{}
		\label{ssssec:#2}
		\global\def\nxSDepth{3}
		\def\nxTa{\nxBox{light}{\nxRoman{\the\nxSN}.\nxRoman{\the\nxSSN}.\nxRoman{\the\nxSSSN}.\nxRoman{\the\nxSSSSN}}\bf~~\nxSSSS}
	}
	\begin{NxILBox}[#1, hdrA, sdwA, frmE, title={\nxTa}]
}{\end{NxILBox}\bigskip}

\newtcblisting{NxCodeBox}[2]{
	listing engine=minted,
	minted style=colorful,
	minted language=#1,
	skin=spartan,
	left=14mm,
	hdrE,
	listing only,
	enhanced,
	breakable,
	overlay={
		\begin{tcbclipinterior}
			\fill[nex.dark.frame] (frame.south west) rectangle ([xshift=10mm]frame.north west);
		\end{tcbclipinterior}
		\node[below left, text width=\textwidth, align=left] at (frame.north west) {\tcbtitle}; % Make the title wrap & fill
	},
	minted options={
		linenos,
		autogobble,
		frame=lines,
		numberblanklines,
		rulecolor=\color{nex.dark.frame},
		framesep=3mm,
		style=dracula,
		encoding=UTF-8,
		tabsize=4,
		fontsize=\footnotesize,
		keywordcase=lower,
		numbers=left,
		breaklines,
		breakautoindent=false,
		breaksymbolindentleft=0pt,
		breaksymbolsepleft=0pt,
		breaksymbolindentright=0pt,
		escapeinside=@@
	},
	IfBlankF={#2}{#2}
}

\long\def\nxItem#1#2#3{\item[\textcolor{nex.#1.frame}{#2}] #3}
\long\def\nxItemD#1#2{\nxItem{dark}{#1}{#2}}
\long\def\nxItemL#1#2{\nxItem{light}{#1}{#2}}
\long\def\nxItemN#1{\item[]#1}

\tcolorboxenvironment{NxListDark}{
	blanker,
	before skip=5mm,
	after skip=5mm,
	borderline west={1mm}{0pt}{nex.dark.frame},
	coltext=nex.dark.text,
}

\tcolorboxenvironment{NxListLight}{
	enhanced,
	before skip=6pt,
	after skip=6pt,
	borderline west={8mm}{0pt}{nex.light.frame},
	colframe={nex.light.frame},
	coltext=nex.light.text,
}

\NewDocumentEnvironment{NxIDBoxL}{O{}}
{
	\begin{NxIDBox}[#1]
		\begin{NxListDark}
}{
		\end{NxListDark}
	\end{NxIDBox}
}


\NewDocumentEnvironment{NxILBoxL}{O{}}
{
	\begin{NxILBox}[#1]
		\begin{NxListLight}
}{
		\end{NxListLight}
	\end{NxILBox}
}

\long\def\nxItemDark#1{\nxItemD{\faArrowAltCircleRight}{#1}}
\long\def\nxCheckDark#1{\nxItemD{\faCheckCircle}{#1}}
\long\def\nxXDark#1{\nxItemD{\faTimesCircle}{#1}}
\long\def\nxCircleDark#1{\nxItemD{\faCircle}{#1}}
\long\def\nxDotDark#1{\nxItemD{\faDotCircle}{#1}}

\long\def\nxItemLight#1{\nxItemL{\faArrowAltCircleRight[regular]}{#1}}
\long\def\nxCheckLight#1{\nxItemL{\faCheckCircle[regular]}{#1}}
\long\def\nxXLight#1{\nxItemL{\faTimesCircle[regular]}{#1}}
\long\def\nxCircleLight#1{\nxItemL{\faCircle[regular]}{#1}}
\long\def\nxDotLight#1{\nxItemL{\faDotCircle[regular]}{#1}}

\long\def\nxBox#1#2{\tcbox[on line, size=fbox, #1]{#2}}
\long\def\nxBoxI#1#2{\nxItemN{\nxBox{#1}{#2}}}

\long\def\nxEmph#1#2{\textcolor{nex.#1}{#2}}

\long\def\nxTopicBlueprint#1#2{\nxEmph{#1}{\dashuline{\bf\it#2}}}
\long\def\nxTopic#1#2{\nxTopicBlueprint{#1}{#2}~$\Rightarrow$~}

\long\def\nxTopicRefBlueprint#1#2#3{\item[\nxBox{primary}{#2}]\hyperref[#1]{\nxTopicBlueprint{primary.link}{#3}}~$\Rightarrow$~}
\long\def\nxTopicU#1{\nxTopicRefBlueprint{{\ifcase\nxSDepth sec:\or ssec:\or sssec:\fi#1}}{\faAngleUp}{#1}}
\long\def\nxTopicD#1{\nxTopicRefBlueprint{{\ifcase\nxSDepth ssec:\or sssec:\or ssssec:\fi#1}}{\faAngleDown}{#1}}

\long\def\nxIDTopic#1{\nxTopic{warning.back}{#1}}
\long\def\nxILTopic#1{\nxTopic{primary.back}{#1}}

