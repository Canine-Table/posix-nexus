\RequirePackage{ifluatex} % Checks if the document is compiled with LuaLaTeX
\ifluatex%
	\usepackage{luacode} % Allows embedding Lua code directly in LaTeX
	\edef\nxTeXPath{\directlua{tex.sprint(os.getenv("TEXMFHOME"))}}
	\directlua{
		local pkgrt = os.getenv('NEXUS_LIB') .. '/lua/'
		package.path = pkgrt .. '?.lua;' .. pkgrt .. 'opt/?.lua;' .. package.path
		package.path = pkgrt .. 'luatex/?.lua;' .. pkgrt  .. 'luatex/opt/?.lua;' .. package.path
		nex = require('luatex/nex-luatex-init')
	}
	\input{\nxTeXPath/nex-package.tex}
	\input{\nxTeXPath/nex-lua.tex}
	\input{\nxTeXPath/nex-config.tex}
	\input{\nxTeXPath/nex-param.tex}
	\input{\nxTeXPath/nex-misc.tex}
	\input{\nxTeXPath/nex-color.tex}
	\input{\nxTeXPath/nex-box.tex}
	\input{\nxTeXPath/nex-tikz.tex}
	\input{\nxTeXPath/nex-pgf.tex}
	\input{\nxTeXPath/nex-sec.tex}
	\input{\nxTeXPath/nex-typography.tex}
	\input{\nxTeXPath/nex-renew.tex}
	\makeatletter
	\def\input@path{{\nxTeXPath/sty/}}
	\makeatother
	\message{Posix-Nexus LuaLaTeX preamble fully loaded!}
\else%
	\PackageError{luacode}{LuaTeX is required, but not detected}{}%
\fi%

